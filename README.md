# Тестовое задание для курса Python: REST-сервис просмотра текущей зарплаты и даты следующего повышения

## Инструкция для запуска

Для запуска приложения нужно сделать следующее:

``` 
git clone https://github.com/ivanil97/salary-info-api

cd salary-info-api
```

Заполните файл *.env*, в качестве шаблона можно воспользоваться файлом *.env.template*

```
DB_USER= "имя пользователя PostgreSQL"
DB_PASS= "пароль для указанного пользователя"
DB_NAME= "название базы данных"
DB_HOST= "хост сервера базы данных (для развертывания контейнера в docker укажите db, для локальной разработки укажите localhost)"
DB_PORT= "порт, на котором работает PostgreSQL (по умолчанию 5432)"
DEFAULT_PROMOTION_PERIOD= "количество дней, через которое по умолчанию происходит повышение"
ACCESS_TOKEN_EXPIRES_IN_MINUTES= "время действия токена в минутах, генерируемого при авторизации пользователя"
SECRET_KEY= "строка, используемая для подписи JWT-токенов и защиты данных"
INITIAL_ADMIN_EMAIL= "электронная почта (логин) администратора
INITIAL_ADMIN_PASSWORD= "пароль администратора"
```

```
docker-compose up --build -d
```

Это запустит приложение по адресу http://127.0.0.1:8000/

Описание API-эндпойнтов (Swagger) можно найти по адресу http://127.0.0.1:8000/docs

Тесты можно запустить командой ```docker exec salary_info_api pytest tests```

## Документация

Все роуты доступны только авторизованным пользователям.  
Для всех запросов роутов кроме **/login/** нужно использовать JWT-токен в заголовке:
```
Authorization: Bearer <ваш токен>
```
## Пользователи

Все роуты группы _Пользователи_ доступны только пользователям с ролью **_admin_**

### Создание пользователя

Чтобы создать пользователя, нужно сделать POST-запрос к роуту **/register/** с данными следующего вида:

```
{
    "first_name": "Ivan",
    "last_name": "Petrov",
    "email": "ivan_petrov@example.com",
    "password": "12345678",
    "role": "employee"
}
```

### Получение списка пользователей

Для получения списка существующих пользователей необходимо сделать GET-запрос к роуту **/users/**  

### Получение пользователя по ID

Для получения пользователя по ID необходимо сделать GET-запрос к роуту **/users/{user_id}/**  

## Заработная плата

### Создание ставки заработной платы

Чтобы создать ставку заработной платы, нужно сделать POST-запрос к роуту **/salary/** с данными следующего вида:

```
{
    "amount": 30000,
    "promotion_date": "2026-12-31",
    "user_id": 1
}
```

Поле _promotion_date_ является необязательным  
Данный роут доступен только пользователям с ролью **_admin_**

### Получение списка ставок заработной платы

Для получения списка существующих ставок заработной платы необходимо сделать GET-запрос к роуту **/salary/**
Данный роут доступен только пользователям с ролью **_admin_**

### Получение списка индивидуальных ставок заработной платы сотрудника

Данный роут предназначен для просмотра сотрудником его текущей зарплаты и даты следующего повышения по каждой ставке  
Для получения этих данных пользователю необходимо авторизоваться и сделать GET-запрос к роуту **/my_salary/**

В ответе на запрос сервис возвращает данные вида:

```
[
  {
    "id": 1,
    "amount": 30000,
    "promotion_date": "2026-07-09T19:26:38.530822",
    "user_id": 1
  }
]
```

где id - номер ставки заработной платы в базе данных, amount - сумма заработной платы по данной ставке, promotion_date - дата следующего повышения,
user_id - номер сотрудника в базе данных
